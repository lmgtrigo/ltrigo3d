<script>
    let cart = [];
    let total = 0;

    function addToCart(product, price, imgSrc) {
      const existingItem = cart.find(item => item.product === product);
      if (existingItem) {
        existingItem.quantity += 1;
      } else {
        cart.push({ id: Date.now(), product, price, imgSrc, quantity: 1 });
      }
      total += price;
      updateCart();
    }

    function removeFromCart(itemId) {
      const itemIndex = cart.findIndex(item => item.id === itemId);
      if (itemIndex > -1) {
        total -= cart[itemIndex].price * cart[itemIndex].quantity;
        cart.splice(itemIndex, 1);
        updateCart();
      }
    }

    function updateCart() {
      const cartItems = document.getElementById('cart-items');
      const cartTotal = document.getElementById('cart-total');
      const cartElement = document.getElementById('cart');
      cartItems.innerHTML = '';

      cart.forEach(item => {
        const li = document.createElement('li');
        li.className = "flex justify-between items-center";
        li.innerHTML = `
          <div class="flex items-center gap-3">
            <img src="${item.imgSrc}" alt="${item.product}" class="w-12 h-12 rounded-md object-cover">
            <div>
              <span class="font-semibold">${item.product}</span><br>
              <span class="text-gray-600 text-sm">€${item.price} x ${item.quantity}</span>
            </div>
          </div>
          <button onclick="removeFromCart(${item.id})" class="text-red-500 hover:text-red-700">&times;</button>
        `;
        cartItems.appendChild(li);
      });

      cartTotal.textContent = total.toFixed(2);
      cartElement.classList.toggle('scale-0', cart.length === 0);
    }

    function checkout() {
      if (cart.length === 0) return alert('Carrinho vazio!');

      // Popup para pedir número MB WAY
      const mbwayNumber = prompt('Introduz o teu número MB WAY para pagamento:');
      if (!mbwayNumber || !/^\d{9}$/.test(mbwayNumber)) {
        alert('Número MB WAY inválido. Deve conter 9 dígitos.');
        return;
      }

      let message = `Olá, gostaria de encomendar:\n`;
      cart.forEach(item => message += `- ${item.product} (€${item.price}) x ${item.quantity}\n`);
      message += `Total: €${total.toFixed(2)}\n`;
      message += `Número MB WAY para pagamento: ${mbwayNumber}`;

      const whatsapp = '351912345678'; // <-- Teu número WhatsApp aqui
      window.open(`https://wa.me/${whatsapp}?text=${encodeURIComponent(message)}`, '_blank');
    }
</script>
